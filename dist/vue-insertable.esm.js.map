{"version":3,"file":"vue-insertable.esm.js","sources":["../src/insert-view.ts","../src/install.ts","../src/insertable.ts"],"sourcesContent":["import { RenderContext, VNode, CreateElement, VNodeData } from 'vue';\nimport Insertable from './insertable';\nfunction cloneVNodeData(data: VNodeData): VNodeData {\n\tconst {\n\t\tkey,\n\t\tslot,\n\t\tref,\n\t\tstaticClass,\n\t\tclass: className,\n\t\tstaticStyle,\n\t\tstyle,\n\t\tprops,\n\t\tattrs,\n\t\tdomProps,\n\t\ton,\n\t\tnativeOn,\n\t\tshow,\n\t\tdirectives,\n\t\tkeepAlive,\n\t} = data;\n\treturn {\n\t\tkey,\n\t\tslot,\n\t\tref,\n\t\trefInFor: true,\n\t\tstaticClass,\n\t\tclass: className,\n\t\tstaticStyle,\n\t\tstyle,\n\t\tprops: { ...props},\n\t\tattrs: { ...attrs},\n\t\tdomProps: { ...domProps},\n\t\ton: { ...on},\n\t\tnativeOn: { ...nativeOn},\n\t\tshow,\n\t\tdirectives: directives && [...directives],\n\t\tkeepAlive,\n\t}\n}\n\n// scopedSlots?: { [key: string]: ScopedSlot | undefined };\n// tag?: string;\n// hook?: { [key: string]: Function };\n// transition?: object;\n// inlineTemplate?: {\n//   render: Function;\n//   staticRenderFns: Function[];\n// };\n\nconst InsertView = ({\n\tname: 'InsertView',\n\tfunctional: true,\n\trender(\n\t\th: CreateElement,\n\t\t{ parent, props, data }: RenderContext<{ name: string; }> & { parent: {$insertable?: Insertable} }\n\t): VNode[] {\n\t\tconst { name } = props;\n\t\tconst { $insertable: insertable } = parent;\n\t\tif (!insertable){ return []; }\n\t\tconst list = insertable.get(name);\n\t\tif (!list) { return []; }\n\t\treturn list.map(t => h(t, cloneVNodeData(data)));\n\t},\n});\n\n\nexport default InsertView;\n","import { VueConstructor } from 'vue';\nimport Insertable from './insertable';\nimport InsertView from './insert-view';\nlet _vue: VueConstructor | undefined;\nexport default function install(Vue: VueConstructor) {\n\tif (_vue === Vue) { return; }\n\t_vue = Vue;\n\tObject.defineProperty(Vue.prototype, '$insertable', {\n\t\tget() { if (this.$parent) { return this.$parent.$insertable; } },\n\t\tconfigurable: true,\n\t});\n\tVue.component('InsertView', InsertView);\n\tVue.mixin({\n\t\tbeforeCreate(this: VueConstructor['prototype'] & {$insertable?: Insertable, $parent: {$insertable?: Insertable}}) {\n\t\t\tconst options = this.$options as {insertable?: Insertable | (() => Insertable)};\n\t\t\tif (options.insertable) {\n\t\t\t\tObject.defineProperty(this, '$insertable', {\n\t\t\t\t\tvalue: typeof options.insertable === 'function' ? options.insertable() : options.insertable,\n\t\t\t\t\tconfigurable: true,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t});\n}\nexport {\n\t_vue as Vue,\n};\n","import { Component, AsyncComponent } from 'vue';\nimport install, { Vue } from './install';\nimport InsertView from './insert-view';\n\nexport type InsertableComponent = (string | Component<any, any, any, any> | AsyncComponent<any, any, any, any> | (() => Component));\nexport interface Info {\n\tcomponent: InsertableComponent;\n\torder: number;\n}\n\nexport interface Options {\n\tgroups?: {[key: string]: InsertableComponent | InsertableComponent[]}\n}\nclass Insertable {\n\tconstructor(options: Options);\n\tconstructor({ groups = {} }: Options = {}) {\n\t\tfor (let k in groups) {\n\t\t\tthis.set(k, groups);\n\t\t}\n\t}\n\tinit(): {[key: string]: Info[]} {\n\t\tif (this._inited) { return this.groups; }\n\t\tif (!Vue) { return this.groups; }\n\t\tthis._inited = true;\n\t\tconst groups = Object.create(null);\n\t\tconst old = this.groups;\n\t\tfor (const k in old) {\n\t\t\tVue.set(groups, k, old[k]);\n\t\t}\n\t\tthis.groups = groups;\n\t\treturn groups;\n\t}\n\tgroups: {[key: string]: Info[]} = Object.create(null);\n\t_inited = false;\n\tadd(name: string, components: InsertableComponent | InsertableComponent[], order = 0) {\n\t\tconst groups = this.init();\n\t\tif (!Array.isArray(components)) { components = [components]; }\n\t\tconst list = groups[name] ? [...groups[name]] : [];\n\t\tlist.push(...components.map(component => ({ component, order })));\n\t\tlist.sort(({order: a}, {order: b}) => a - b);\n\t\tif (Vue) {\n\t\t\tVue.set(groups, name, list);\n\t\t} else {\n\t\t\tgroups[name] = list;\n\t\t}\n\t}\n\tremove(name: string): void;\n\tremove(name: string, component: InsertableComponent, order?: number): void;\n\tremove(name: string, component?: InsertableComponent, order = 0): void {\n\t\tconst groups = this.init();\n\t\tconst oldList = groups[name];\n\t\tif (!oldList) { return; }\n\t\tif (!component) {\n\t\t\tif (Vue) {\n\t\t\t\tVue.set(groups, name, []);\n\t\t\t} else {\n\t\t\t\tgroups[name] = [];\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tconst k = oldList.findIndex(t => t.component === component && t.order === order);\n\t\tif (k < 0) { return; }\n\t\tconst list = [...oldList.slice(0, k), ...oldList.slice(k + 1)];\n\t\tif (Vue) {\n\t\t\tVue.set(groups, name, list);\n\t\t} else {\n\t\t\tgroups[name] = list;\n\t\t}\n\t}\n\tset(name: string, components: InsertableComponent | InsertableComponent[], order = 0) {\n\t\tconst groups = this.init();\n\t\tif (!Array.isArray(components)) { components = [components]; }\n\t\tconst list = components.map(component => ({ component, order }));\n\t\tif (Vue) {\n\t\t\tVue.set(groups, name, list);\n\t\t} else {\n\t\t\tgroups[name] = list;\n\t\t}\n\t}\n\tget(name: string): InsertableComponent[] {\n\t\tconst groups = this.init();\n\t\tconst list = groups[name] || [];\n\t\treturn list.map(({component}) => component);\n\t}\n\tstatic get install() { return install; };\n\tstatic get View() { return InsertView; };\n\tstatic readonly version = '__VERSION__';\n}\nexport default Insertable;\n"],"names":["cloneVNodeData","data","key","slot","ref","staticClass","class","className","staticStyle","style","props","attrs","domProps","on","nativeOn","show","directives","keepAlive","refInFor","InsertView","name","functional","render","h","parent","$insertable","insertable","list","get","map","t","_vue","install","Vue","Object","defineProperty","prototype","$parent","configurable","component","mixin","beforeCreate","options","$options","value","Insertable","constructor","groups","create","k","set","init","_inited","old","add","components","order","Array","isArray","push","sort","a","b","remove","oldList","findIndex","slice","View"],"mappings":"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"}