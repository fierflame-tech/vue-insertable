{"version":3,"file":"vue-insertable.js","sources":["../src/insert-view.ts","../src/insertable.ts","../src/install.ts","../src/browser.ts"],"sourcesContent":["import { RenderContext, VNode, CreateElement, VNodeData } from 'vue';\nimport Insertable from './insertable';\nfunction cloneVNodeData(data: VNodeData): VNodeData {\n\tconst {\n\t\tkey,\n\t\tslot,\n\t\tref,\n\t\tstaticClass,\n\t\tclass: className,\n\t\tstaticStyle,\n\t\tstyle,\n\t\tprops,\n\t\tattrs,\n\t\tdomProps,\n\t\ton,\n\t\tnativeOn,\n\t\tshow,\n\t\tdirectives,\n\t\tkeepAlive,\n\t} = data;\n\treturn {\n\t\tkey,\n\t\tslot,\n\t\tref,\n\t\trefInFor: true,\n\t\tstaticClass,\n\t\tclass: className,\n\t\tstaticStyle,\n\t\tstyle,\n\t\tprops: { ...props},\n\t\tattrs: { ...attrs},\n\t\tdomProps: { ...domProps},\n\t\ton: { ...on},\n\t\tnativeOn: { ...nativeOn},\n\t\tshow,\n\t\tdirectives: directives && [...directives],\n\t\tkeepAlive,\n\t}\n}\n\n// scopedSlots?: { [key: string]: ScopedSlot | undefined };\n// tag?: string;\n// hook?: { [key: string]: Function };\n// transition?: object;\n// inlineTemplate?: {\n//   render: Function;\n//   staticRenderFns: Function[];\n// };\n\nconst InsertView = ({\n\tname: 'InsertView',\n\tfunctional: true,\n\trender(\n\t\th: CreateElement,\n\t\t{ parent, props, data }: RenderContext<{ name: string; }> & { parent: {$insertable?: Insertable} }\n\t): VNode[] {\n\t\tconst { name } = props;\n\t\tconst { $insertable: insertable } = parent;\n\t\tif (!insertable){ return []; }\n\t\tconst list = insertable.get(name);\n\t\tif (!list) { return []; }\n\t\treturn list.map(t => h(t, cloneVNodeData(data)));\n\t},\n});\n\n\nexport default InsertView;\n","import { Component, AsyncComponent } from 'vue';\nimport install, { Vue } from './install';\nimport InsertView from './insert-view';\n\nexport type InsertableComponent = (string | Component<any, any, any, any> | AsyncComponent<any, any, any, any> | (() => Component));\nexport interface Info {\n\tcomponent: InsertableComponent;\n\torder: number;\n}\n\nexport interface Options {\n\tgroups?: {[key: string]: InsertableComponent | InsertableComponent[]}\n}\nclass Insertable {\n\tprivate _inited = false;\n\treadonly parent?: Insertable;\n\tprivate _groups: {[key: string]: Info[]} = Object.create(null);\n\tconstructor(options?: Options);\n\tconstructor(parent: Insertable, options?: Options);\n\tconstructor(parent?: Insertable | Options, options?: Options) {\n\t\tif (parent instanceof Insertable) {\n\t\t\tthis.parent = parent;\n\t\t} else {\n\t\t\t[parent, options] = [, parent];\n\t\t}\n\t\tconst { groups = {} } = options || {};\n\t\tfor (let k in groups) {\n\t\t\tthis.set(k, groups);\n\t\t}\n\t}\n\tprivate init(): {[key: string]: Info[]} {\n\t\tif (this._inited) { return this._groups; }\n\t\tif (!Vue) { return this._groups; }\n\t\tthis._inited = true;\n\t\tconst groups = Object.create(null);\n\t\tconst old = this._groups;\n\t\tfor (const k in old) {\n\t\t\tVue.set(groups, k, old[k]);\n\t\t}\n\t\tthis._groups = groups;\n\t\treturn groups;\n\t}\n\tadd(name: string, components: InsertableComponent | InsertableComponent[], order = 0) {\n\t\tconst groups = this.init();\n\t\tif (!Array.isArray(components)) { components = [components]; }\n\t\tconst list = groups[name] ? [...groups[name]] : [];\n\t\tlist.push(...components.map(component => ({ component, order })));\n\t\tlist.sort(({order: a}, {order: b}) => a - b);\n\t\tif (Vue) {\n\t\t\tVue.set(groups, name, list);\n\t\t} else {\n\t\t\tgroups[name] = list;\n\t\t}\n\t}\n\tremove(name: string): void;\n\tremove(name: string, component: InsertableComponent, order?: number): void;\n\tremove(name: string, component?: InsertableComponent, order = 0): void {\n\t\tconst groups = this.init();\n\t\tconst oldList = groups[name];\n\t\tif (!oldList) { return; }\n\t\tif (!component) {\n\t\t\tif (Vue) {\n\t\t\t\tVue.set(groups, name, []);\n\t\t\t} else {\n\t\t\t\tgroups[name] = [];\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tconst k = oldList.findIndex(t => t.component === component && t.order === order);\n\t\tif (k < 0) { return; }\n\t\tconst list = [...oldList.slice(0, k), ...oldList.slice(k + 1)];\n\t\tif (Vue) {\n\t\t\tVue.set(groups, name, list);\n\t\t} else {\n\t\t\tgroups[name] = list;\n\t\t}\n\t}\n\tset(name: string, components: InsertableComponent | InsertableComponent[], order = 0) {\n\t\tconst groups = this.init();\n\t\tif (!Array.isArray(components)) { components = [components]; }\n\t\tconst list = components.map(component => ({ component, order }));\n\t\tif (Vue) {\n\t\t\tVue.set(groups, name, list);\n\t\t} else {\n\t\t\tgroups[name] = list;\n\t\t}\n\t}\n\tprivate _getInfo(name: string, noParentList?: boolean): Info[] {\n\t\tconst groups = this.init();\n\t\tconst list = groups[name] || [];\n\t\tif (noParentList) { return list; }\n\t\tconst parentList = this.parent ? this.parent._getInfo(name) : [];\n\t\tconst allList = [...parentList, ...list];\n\t\tif (list.length && parentList.length) {\n\t\t\tallList.sort(({order: a}, {order: b}) => a - b);\n\t\t}\n\t\treturn allList;\n\t}\n\tget(name: string, noParentList?: boolean): InsertableComponent[] {\n\t\treturn this._getInfo(name, noParentList).map(({component}) => component);\n\t}\n\tstatic get install() { return install; };\n\tstatic get View() { return InsertView; };\n\tstatic readonly version = '__VERSION__';\n}\nexport default Insertable;\n","import { VueConstructor } from 'vue';\nimport Insertable from './insertable';\nimport InsertView from './insert-view';\nlet _vue: VueConstructor | undefined;\nexport default function install(Vue: VueConstructor) {\n\tif (_vue === Vue) { return; }\n\t_vue = Vue;\n\tObject.defineProperty(Vue.prototype, '$insertable', {\n\t\tget() { if (this.$parent) { return this.$parent.$insertable; } },\n\t\tconfigurable: true,\n\t});\n\tVue.component('InsertView', InsertView);\n\tVue.mixin({\n\t\tbeforeCreate(this: VueConstructor['prototype'] & {$insertable?: Insertable, $parent: {$insertable?: Insertable}}) {\n\t\t\tconst options = this.$options as {insertable?: Insertable | ((parent?: Insertable) => Insertable)};\n\t\t\tlet insertable =  options.insertable;\n\t\t\tif (typeof insertable === 'function') {\n\t\t\t\tinsertable = insertable(this.$parent && this.$parent.$insertable);\n\t\t\t}\n\t\t\tif (insertable instanceof Insertable) {\n\t\t\t\tObject.defineProperty(this, '$insertable', {\n\t\t\t\t\tvalue: insertable,\n\t\t\t\t\tconfigurable: true,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t});\n}\nexport {\n\t_vue as Vue,\n};\n","import Vue from 'vue';\nimport install from './install';\n\nif (Vue) { install(Vue); }\nexport { default } from './insertable';\n"],"names":["cloneVNodeData","data","key","slot","ref","staticClass","class","className","staticStyle","style","props","attrs","domProps","on","nativeOn","show","directives","keepAlive","refInFor","InsertView","name","functional","render","h","parent","$insertable","insertable","list","get","map","t","Insertable","constructor","options","Object","create","groups","k","set","init","_inited","_groups","Vue","old","add","components","order","Array","isArray","push","component","sort","a","b","remove","oldList","findIndex","slice","_getInfo","noParentList","parentList","allList","length","install","View","_vue","defineProperty","prototype","$parent","configurable","mixin","beforeCreate","$options","value"],"mappings":"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"}